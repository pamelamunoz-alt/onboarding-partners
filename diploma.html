<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Diploma | PedidosYa Partners</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --rosa:#FA0050;
  --celeste:#61C8FA;
  --negro:#111217;
  --gris:#F4F5F7;
  --blanco:#ffffff;
}

*{ box-sizing:border-box; margin:0; padding:0; }

body{
  font-family:Poppins, sans-serif;
  background: var(--gris);
  color: var(--negro);
  padding: 22px;
}

.topbar{
  max-width:1100px;
  margin:0 auto 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.actions{ display:flex; gap:10px; }

.btn{
  border:0;
  border-radius:12px;
  padding:12px 18px;
  font-weight:800;
  cursor:pointer;
  transition:.2s;
  font-size:14px;
}

.btn.primary{ background:var(--rosa); color:white; }
.btn.primary:hover{ background:#ff3377; }

.btn.secondary{ background:#111217; color:white; }
.btn.secondary:hover{ background:#2a2c33; }

.stage{
  max-width:1100px;
  margin:0 auto;
  display:flex;
  justify-content:center;
}

/* ================= DIPLOMA ================= */

#diploma{
  width:1123px;
  height:794px;
  background:white;
  border-radius:20px;
  position:relative;
  overflow:hidden;
  box-shadow:0 20px 50px rgba(0,0,0,.08);
}

/* Decoraciones suaves */
.corner{
  position:absolute;
  right:-120px;
  top:-120px;
  width:260px;
  height:260px;
  background:var(--celeste);
  border-radius:999px;
  opacity:.85;
}

.corner2{
  position:absolute;
  left:-150px;
  bottom:-150px;
  width:320px;
  height:320px;
  background:#ffd1e0;
  border-radius:999px;
  opacity:.6;
}

/* INSIGNIA */
.badge{
  position:absolute;
  top:40px;
  right:60px;
  background:linear-gradient(135deg,var(--rosa),#ff4f87);
  color:white;
  padding:10px 18px;
  border-radius:50px;
  font-size:12px;
  font-weight:700;
  letter-spacing:1px;
}

/* CONTENIDO CENTRADO */
.content{
  position:absolute;
  inset:0;
  padding:100px 120px 80px 120px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  text-align:center;
}

.brand{
  font-weight:800;
  font-size:18px;
  letter-spacing:.5px;
}

.subtitle{
  font-size:14px;
  opacity:.7;
  margin-top:6px;
}

.title{
  font-size:54px;
  letter-spacing:4px;
  margin-top:40px;
  font-weight:800;
}

.text{
  margin-top:25px;
  font-size:16px;
  opacity:.85;
}

.name{
  margin-top:30px;
  font-size:46px;
  font-weight:800;
  color:var(--rosa);
}

.description{
  margin-top:20px;
  font-size:16px;
  max-width:650px;
  margin-left:auto;
  margin-right:auto;
  line-height:1.6;
}

.divider{
  width:120px;
  height:4px;
  background:var(--rosa);
  border-radius:8px;
  margin:40px auto;
}

.bottom{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  margin-top:40px;
}

.meta{
  text-align:left;
  font-size:13px;
  opacity:.8;
}

.meta strong{
  display:block;
  margin-top:6px;
  font-size:14px;
  opacity:1;
}

.signature{
  text-align:right;
}

.sigline{
  width:220px;
  height:2px;
  background:#ddd;
  margin-bottom:8px;
}

.siglabel{
  font-size:13px;
  opacity:.8;
}

.footer{
  font-size:12px;
  opacity:.7;
  margin-top:60px;
  display:flex;
  justify-content:space-between;
}

.hint{
  max-width:1100px;
  margin:10px auto;
  font-size:12px;
  opacity:.7;
  text-align:center;
}

@media (max-width:1200px){
  .stage{ overflow:auto; }
}
</style>
</head>

<body>

<div class="topbar">
  <div style="font-weight:800;">ðŸŽ“ Tu diploma</div>
  <div class="actions">
    <button class="btn primary" id="btnPDF">Descargar PDF</button>
    <button class="btn secondary" id="btnCurso">Volver al curso</button>
  </div>
</div>

<div class="stage">
  <div id="diploma">

    <div class="corner"></div>
    <div class="corner2"></div>
    <div class="content">

      <div>
        <div class="brand">PEDIDOSYA - EQUIPO DE OPERACIONES</div>
        <div class="subtitle">Certificado de FinalizaciÃ³n</div>

        <div class="title">DIPLOMA</div>

        <div class="text">Se otorga el presente certificado a:</div>

        <div class="name" id="outNombre">Nombre Apellido</div>

        <div class="description">
          Por haber completado satisfactoriamente el curso de capacitaciÃ³n
          y demostrar el conocimiento requerido.
        </div>

        <div class="divider"></div>

        <div class="bottom">
          <div class="meta">
            Fecha de emisiÃ³n
            <strong id="outFecha">--/--/----</strong>
          </div>

          <div class="signature">
            <div class="sigline"></div>
            <div class="siglabel">Equipo de Ops</div>
          </div>
        </div>
      </div>

      <div class="footer">
        <span>Â© PedidosYa</span>
        <span id="codigo">PY-0000</span>
      </div>

    </div>
  </div>
</div>

<div class="hint">
Si tu nombre no aparece, regresa al inicio y vuelve a completar el formulario.
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
function hoyGT(){
  return new Date().toLocaleDateString("es-GT");
}

function getNombreParticipante(){
  const params = new URLSearchParams(window.location.search);
  return (
    params.get("nombre") ||
    localStorage.getItem("partner_nombre") ||
    "Nombre Apellido"
  );
}

function setDiplomaData(){
  const nombre = getNombreParticipante();
  document.getElementById("outNombre").textContent = nombre;
  document.getElementById("outFecha").textContent = hoyGT();

  const year = new Date().getFullYear();
  const code = "PY-" + year + "-" + String(Math.floor(Math.random()*9999)).padStart(4,"0");
  document.getElementById("codigo").textContent = code;
}

async function descargarPDF(){
  setDiplomaData();

  const diploma = document.getElementById("diploma");
  const canvas = await html2canvas(diploma,{scale:2,backgroundColor:"#ffffff"});
  const imgData = canvas.toDataURL("image/png");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({orientation:"landscape",unit:"pt",format:"a4"});

  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  const ratio = Math.min(pageWidth/canvas.width,pageHeight/canvas.height);
  const w = canvas.width*ratio;
  const h = canvas.height*ratio;
  const x = (pageWidth-w)/2;
  const y = (pageHeight-h)/2;

  pdf.addImage(imgData,"PNG",x,y,w,h);

  const nombreArchivo = getNombreParticipante()
    .replace(/\s+/g,"_")
    .replace(/[^\w\-]/g,"")
    .toLowerCase();

  pdf.save(`diploma_${nombreArchivo}.pdf`);
}

function volverCurso(){
  window.location.href="curso.html";
}

document.getElementById("btnPDF").addEventListener("click",descargarPDF);
document.getElementById("btnCurso").addEventListener("click",volverCurso);

setDiplomaData();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Diploma | PedidosYa Partners</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --rosa:#FA0050;
      --celeste:#61C8FA;
      --negro:#111217;
      --gris:#F7F7F7;
      --blanco:#ffffff;
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    body{
      font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--gris);
      color: var(--negro);
      padding: 22px;
    }

    .topbar{
      max-width: 1100px;
      margin: 0 auto 14px;
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .title{
      font-weight: 800;
      font-size: 18px;
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn{
      border:0;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 800;
      cursor:pointer;
      transition: .2s;
      font-size: 14px;
    }
    .btn.primary{ background: var(--rosa); color: var(--blanco); }
    .btn.primary:hover{ background:#ff3377; transform: scale(1.02); }
    .btn.secondary{ background:#111217; color: var(--blanco); }
    .btn.secondary:hover{ background:#2a2c33; transform: scale(1.02); }

    .stage{
      max-width: 1100px;
      margin: 0 auto;
      display:flex;
      justify-content:center;
    }

    /* rea del diploma (esto es lo que exportamos) */
    #diploma{
      width: 1123px;
      height: 794px;
      background: var(--blanco);
      border-radius: 18px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
    }

    .band{ position:absolute; left:0; top:0; bottom:0; width: 26px; background: var(--rosa); }
    .corner{ position:absolute; right:-120px; top:-120px; width: 260px; height: 260px; background: var(--celeste); border-radius: 999px; opacity:.85; }
    .corner2{ position:absolute; left:-160px; bottom:-160px; width: 340px; height: 340px; background: #ffd1e0; border-radius: 999px; opacity:.7; }

    .content{
      position:absolute;
      inset:0;
      padding: 70px 90px 60px 110px;
      display:flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .top{
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap: 16px;
    }

    .brand{
      font-weight: 800;
      letter-spacing: .5px;
      font-size: 18px;
    }
    .brand small{
      display:block;
      font-weight: 600;
      opacity: .7;
      font-size: 12px;
      margin-top: 6px;
    }

    .titleBlock{ margin-top: 26px; }
    .titleBlock h1{ margin:0; font-size: 44px; letter-spacing: .2px; }
    .titleBlock p{ margin: 12px 0 0; font-size: 16px; opacity: .85; max-width: 720px; line-height: 1.5; }

    .name{
      margin-top: 22px;
      font-size: 40px;
      font-weight: 800;
      color: var(--rosa);
      letter-spacing: .3px;
      word-break: break-word;
    }

    .meta{
      display:flex;
      justify-content: space-between;
      align-items:flex-end;
      gap: 20px;
      margin-top: 18px;
    }

    .meta .box{
      border-top: 2px solid #e8e9ee;
      padding-top: 14px;
      font-size: 13px;
      opacity:.9;
      width: 40%;
    }
    .meta .box strong{ display:block; margin-top: 6px; font-size: 14px; opacity:1; }

    .signature{
      width: 40%;
      text-align:right;
    }
    .sigline{ margin-top: 24px; height: 2px; background:#e8e9ee; }
    .siglabel{ margin-top: 8px; font-size: 12px; opacity:.75; }

    .footer{
      display:flex;
      justify-content: space-between;
      align-items:center;
      font-size: 12px;
      opacity:.75;
    }

    .hint{
      max-width:1100px;
      margin: 10px auto 0;
      font-size: 12px;
      opacity: .75;
      text-align:center;
      line-height:1.4;
    }

    @media (max-width: 1200px){
      .stage{ overflow:auto; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="title"> Tu diploma</div>

    <div class="actions">
      <button class="btn primary" id="btnPDF">Descargar PDF</button>
      <button class="btn secondary" id="btnCurso">Volver al curso</button>
    </div>
  </div>

  <div class="stage">
    <div id="diploma">
      <div class="band"></div>
      <div class="corner"></div>
      <div class="corner2"></div>

      <div class="content">
        <div>
          <div class="top">
            <div class="brand">
              PEDIDOSYA PARTNERS
              <small>Certificado de finalizaci贸n</small>
            </div>
            <div style="text-align:right; font-size:12px; opacity:.7;">
              C贸digo: <span id="codigo">PY-0000</span>
            </div>
          </div>

          <div class="titleBlock">
            <h1>DIPLOMA</h1>
            <p>Se otorga el presente certificado a:</p>

            <div class="name" id="outNombre">Nombre Apellido</div>

            <p>
              Por haber completado satisfactoriamente el curso de capacitaci贸n de
              <strong>PedidosYa Partners</strong> y demostrar el conocimiento requerido.
            </p>
          </div>

          <div class="meta">
            <div class="box">
              Fecha de emisi贸n
              <strong id="outFecha">--/--/----</strong>
            </div>

            <div class="signature">
              <div class="sigline"></div>
              <div class="siglabel">Equipo de Capacitaci贸n</div>
            </div>
          </div>
        </div>

        <div class="footer">
          <span>漏 PedidosYa Partners</span>
          <span id="footerName">Onboarding</span>
        </div>
      </div>
    </div>
  </div>

  <div class="hint">
    Si tu nombre no aparece, regresa al inicio y vuelve a completar el formulario.
  </div>

  <!-- Librer铆as para exportar -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    function hoyGT() {
      const d = new Date();
      return d.toLocaleDateString("es-GT");
    }

    function getNombreParticipante() {
      const params = new URLSearchParams(window.location.search);
      const nombreURL = (params.get("nombre") || "").trim();

      return (
        nombreURL ||
        localStorage.getItem("curso_nombre") ||
        localStorage.getItem("partner_nombre") ||
        "Nombre Apellido"
      );
    }

    function setDiplomaData() {
      const nombre = getNombreParticipante();
      document.getElementById("outNombre").textContent = nombre;
      document.getElementById("outFecha").textContent = hoyGT();
      document.getElementById("footerName").textContent = "Onboarding Partners";

      const year = new Date().getFullYear();
      const code = "PY-" + year + "-" + String(Math.floor(Math.random() * 9999)).padStart(4, "0");
      document.getElementById("codigo").textContent = code;
    }

    async function descargarPDF() {
      setDiplomaData();

      const diploma = document.getElementById("diploma");
      const canvas = await html2canvas(diploma, {
        scale: 2,
        useCORS: true,
        backgroundColor: "#ffffff"
      });

      const imgData = canvas.toDataURL("image/png");
      const { jsPDF } = window.jspdf;

      const pdf = new jsPDF({ orientation: "landscape", unit: "pt", format: "a4" });
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      const ratio = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);
      const w = canvas.width * ratio;
      const h = canvas.height * ratio;
      const x = (pageWidth - w) / 2;
      const y = (pageHeight - h) / 2;

      pdf.addImage(imgData, "PNG", x, y, w, h, undefined, "FAST");

      const nombreBase = getNombreParticipante();
      const nombreArchivo = nombreBase
        .trim()
        .replace(/\s+/g, "_")
        .replace(/[^\w\-]/g, "")
        .toLowerCase();

      pdf.save(`diploma_${nombreArchivo || "participante"}.pdf`);
    }

    function volverCurso() {
      localStorage.setItem("modoLibre", "true");
      window.location.href = "curso.html";
    }

    document.getElementById("btnPDF").addEventListener("click", descargarPDF);
    document.getElementById("btnCurso").addEventListener("click", volverCurso);

    setDiplomaData();
  </script>
</body>
</html>